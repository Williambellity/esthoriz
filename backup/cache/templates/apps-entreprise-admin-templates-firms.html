<div id="blocks">
	<div class="block">
		<script type="text/javascript">
			$(function() {
				var trans;
				$('#firm').autocomplete({
					source: function(objRequest, response) {
						$.ajax({
							method: 'get',
							url: '/admin/entreprise/ajax_firms/',
							data: "term="+objRequest.term,
							beforeSend: function() {
								$('#firm').addClass('loading');
							},
							complete: function() {
								$('#firm').removeClass('loading');
							}, //stop showing loading when the process is complete
							success: function(result) {
								var res = $.parseJSON(result);
								trans = res.trans;
								response(res.data);
							},
							error: function() {
								alert('Erreur lors du chargement de la liste des entreprises.');
							}
						});
					},
					// Lorsqu'un item est sélectionné dans la liste
					select: function(event, ui) {
						var firmid = trans[ui.item.value];
						window.location = '/admin/entreprise/fiche/'+firmid+'/';
					}
				});
			});
		</script>
		<div class="top"></div>
		<h2>Rechercher</h2>
		<form action="" method="post">
			<label for="firm">Nom :</label>
			<input id="firm" type="text" name="firm" value="" />
		</form>
	</div>
	<div class="block">
		<div class="top"></div>
		<h2>Statistiques</h2>
		<ul>
			<li><?php echo $this->tpl_vars['count']; ?> entreprises</li>
		</ul>
	</div>
</div>
<div id="content">
	<?php if (!empty($this->tpl_vars['note'])): ?><?php echo $this->tpl_vars['note']; ?><?php endif; ?>
	<?php echo $this->tpl_vars['pagination']; ?>
	<table class="liste sorted" cellpadding="0" cellspacing="0">
		<colgroup>
			<col style="width: 30%;" />
			<col style="width: 20%;" />
			<col style="width: 20%;" />
			<col style="width: 20%;" />
			<col style="width: 10%;" />
		</colgroup>
		<tr>
			<th class="sort <?php echo $this->tpl_vars['name_class']; ?>"><a href="/admin/entreprise/firms/name-<?php echo $this->tpl_vars['name_sort']; ?>/">Nom de l'entreprise</a></th>
			<th class="sort <?php echo $this->tpl_vars['cat_name_class']; ?>"><a href="/admin/entreprise/firms/cat_name-<?php echo $this->tpl_vars['cat_name_sort']; ?>/">Secteur d'activité</a></th>
			<th class="sort <?php echo $this->tpl_vars['country_class']; ?>"><a href="/admin/entreprise/firms/country-<?php echo $this->tpl_vars['country_sort']; ?>/">Pays</a></th>
			<th class="sort <?php echo $this->tpl_vars['date_class']; ?>"><a href="/admin/entreprise/firms/date-<?php echo $this->tpl_vars['date_sort']; ?>/">Dernière modification</a></th>
			<th>Actions</th>
		</tr>
		<?php $this->tpl_vars['count'] = 0;if (isset($this->tpl_vars['entreprise_block']) && is_array($this->tpl_vars['entreprise_block'])):
	foreach ($this->tpl_vars['entreprise_block'] as $this->tpl_vars['entreprise']): ?>
			<tr class="<?php if ($this->tpl_vars['count'] % 2 == 0): ?>pair<?php else: ?>impair<?php endif; ?>">
				<td><strong><?php echo $this->tpl_vars['entreprise']['name']; ?></strong></td>
				<td><?php if (!empty($this->tpl_vars['entreprise']['cat_name'])): ?><?php echo $this->tpl_vars['entreprise']['cat_name']; ?>
					<?php else: ?>Aucun<?php endif; ?></td>
				<td><?php echo $this->tpl_vars['entreprise']['country']; ?></td>
				<td>le <?php echo $this->tpl_vars['entreprise']['date']; ?></td>
				<td>
					<a href="/admin/entreprise/fiche/<?php echo $this->tpl_vars['entreprise']['id']; ?>" title="Voir la fiche entreprise"><img src="/themes/system/images/icones/edit.png" alt="Editer" /></a>
					<a href="/admin/entreprise/del/<?php echo $this->tpl_vars['entreprise']['id']; ?>" title="Supprimer"><img src="/themes/system/images/icones/del.png" alt="Supprimer" /></a>
				</td>
			</tr>
		<?php $this->tpl_vars['count']++; endforeach; endif; ?>
		<?php if ($this->tpl_vars['count'] == 0): ?>
			<tr>
				<td colspan="5">Aucune entreprise dans la base de données</td>
			</tr>
		<?php endif; ?>
	</table>
	<?php echo $this->tpl_vars['pagination']; ?>
</div>
<div class="clear"></div>
